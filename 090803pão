// Importa o Supabase
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

// Configuração do Supabase
const SUPABASE_URL = "https://qtgdbqcblngtmemmtmyq.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF0Z2RicWNibG5ndG1lbW10bXlxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDE3MjQ5MDUsImV4cCI6MjA1NzMwMDkwNX0.-CTZAo1dDVus5EJmrZBp7rxYKXNSx8j4DXoyK02ZS1I";
const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// Função para adicionar pontos ao usuário
async function atualizarRank(username) {
    let { data: user, error } = await supabase
        .from("ranks")
        .select("*")
        .eq("username", username)
        .single();

    if (!user) {
        // Se não existe, cria o usuário com rank inicial
        await supabase.from("ranks").insert([
            { username: username, rank: "Recruta Sombrio", pontos: 0 }
        ]);
        console.log("Usuário cadastrado");
    } else {
        // Se existe, atualiza os pontos
        let novosPontos = user.pontos + 10;
        let novoRank = definirRank(novosPontos);

        await supabase.from("ranks").update({
            pontos: novosPontos,
            rank: novoRank
        }).eq("username", username);

        console.log(`Usuário ${username} atualizado para ${novoRank} com ${novosPontos} pontos`);
    }
}

// Define o rank com base nos pontos
function definirRank(pontos) {
    if (pontos >= 5000) return "Lenda";
    if (pontos >= 4000) return "Senhor da Noite";
    if (pontos >= 3000) return "General";
    if (pontos >= 2000) return "Comandante Sombrio";
    if (pontos >= 1500) return "Guardião da Irmandade";
    if (pontos >= 1000) return "Cavaleiro Mascarado";
    if (pontos >= 500) return "Executor Noturno";
    if (pontos >= 250) return "Oficial Oculto";
    if (pontos >= 100) return "Soldado";
    return "Recruta Sombrio";
}

// Teste da função (substitua pelo login real do app)
atualizarRank("blackmask_user");

